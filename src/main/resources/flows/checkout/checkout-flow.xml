<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow
http://www.springframework.org/schema/webflow/spring-webflow-2.4.xsd">

	<var name="order" class="com.bootshop.model.CustomerOrder" />

	<action-state id="addCartToOrder">
		<evaluate expression="cartServiceImpl.validate(requestParameters.cartid)"
			result="order.cart" />
		<transition to="invalidCartWarning" on-exception="java.io.IOException" />
		<transition to="lookupCustomer" />
	</action-state>

	<action-state id="lookupCustomer">
		<evaluate result="order.customer" expression="orderFlowAction.lookupCustomer()" />
		<transition to="registrationForm"
			on-exception="com.bootshop.flow.CustomerNotFoundException" />
		<transition to="orderConfirmation" />
	</action-state>

	<view-state id="registrationForm" model="order" popup="true">
		<transition on="submit" to="addCustomer" />
		<transition on="cancel" to="endState" />
	</view-state>

	<action-state id="addCustomer">
		<evaluate expression="customerServiceImpl.addCustomer(order.customer)" />
		<transition to="showOrder" />
	</action-state>

	<view-state id="orderConfirmation">
		<transition on="submit" to="saveOrder" />
		<transition on="cancel" to="cancel" />
	</view-state>

	<action-state id="saveOrder">
		<evaluate expression="customerOrderServiceImpl.addCustomerOrder(order)" />
		<transition to="thankYou" />
	</action-state>
	
	 <view-state id="thankYou">
      <transition to="endState" />
    </view-state>
        
    <!-- End state -->
    <end-state id="endState" />

</flow>
